int M=1e9+7;
typedef long long ll;
class Solution {
public:
    //This problem is based on NSL and NSR 
    // by using formula sum+=(i-NSL[i])*(NSR[i]-i)
    //Lets write code for finding NSL
    vector<int>getNSL(vector<int>&arr,int n){
        stack<int>st;
        vector<int>result(n,-1);
        for(int i=0;i<n;i++)
        {
            while(!st.empty() && arr[st.top()]>=arr[i]){
                st.pop();
            }
             result[i]=st.empty()?-1:st.top();
            st.push(i);
        }
        return result;
    }
    //Lets write code for finding NSR
    vector<int>getNSR(vector<int>&arr,int n){
        stack<int>st;
        vector<int>result(n,n);
        for(int i=n-1;i>=0;i--)
        {
            while(!st.empty() && arr[st.top()]>arr[i]){
                st.pop();
            }
            result[i]=st.empty()?n:st.top();
            st.push(i);
        }
        return result;
    }
    int sumSubarrayMins(vector<int>& arr) {
        int n=arr.size();
        vector<int>NSL=getNSL(arr,n);//Next Smaller Left
        vector<int>NSR=getNSR(arr,n);//Next Smaller Right
        ll sum=0;
        for(int i=0;i<n;i++)
        {
            ll d1=i-NSL[i];///distance to nearest smallest Left ,Kaha tak range hai small hone ka us element ka  
            ll d2=NSR[i]-i;//distance to nearest smallest Right ,Kaha tak range hai small hone ka us element ka
            ll total_ways_for_i_min=d1*d2;//kitne bar min raha hai
            ll sum_i_in_total_ways=arr[i]*total_ways_for_i_min;//taking sum of that much time 
            sum=(sum+sum_i_in_total_ways)%M;
        }
        return sum;
    }
};
